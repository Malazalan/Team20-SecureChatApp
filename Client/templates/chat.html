<!DOCTYPE html>
<html>
<head>
<title>Home</title>
</head>
<body>
    <h1>Logged in user:{{ current_user.username }}</h1>
    
    <h2>Chatting with {{target_user_id}}</h2>
    
    <div id="messages">
    <b>Contents of chat:</b>
    <br>
    <b>----------------------------------------------</b>
    </div>

    <b>----------------------------------------------</b>
    
    <br> 

    <form id="send_message_form">
        <input type = "text" id = "message_input" placeholder="Message:">
        <button type="submit">Send</button>
    </form>
    
    <br>

    <form action="/home">
        <button type="submit">Home</button>
    </form>

</body>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
<script>

    const socket = io.connect("http://127.0.0.1:5000");
    socket.on('connect', function(){
        socket.emit('user_connect',{
            username: "{{current_user.username}}",
            target: "{{target_user_id}}"
        })
    })

    let message_input = document.getElementById('message_input');

    document.getElementById('send_message_form').onsubmit = function (e) {
        e.preventDefault();
        let message = message_input.value;//.trim();
        if (message.length){
            socket.emit('message_sent',{
                username: "{{current_user.username}}",
                target: "{{target_user_id}}",
                message: message
            })
        message_input.value = '';
        }
    }

    socket.on('recieve_message', function (data) {
        console.log(data);
        const newNode = document.createElement('div');
        newNode.innerHTML = `<b>${data.username}:&nbsp;</b> ${data.message}`;
        document.getElementById('messages').appendChild(newNode);
    });

</script>





</html>